name: Portal Checklist Monitor

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  check-api:
    runs-on: ubuntu-latest

    steps:
      - name: Fast API Health Check
        run: |
          START_TIME=$(date +%s)

          echo "========================================"
          echo "API Health Check Started"
          echo "Time: $(date)"
          echo "========================================"

          STATUS=$(curl \
            --silent \
            --show-error \
            --fail \
            --connect-timeout 5 \
            --max-time 10 \
            --retry 1 \
            --retry-delay 1 \
            --retry-max-time 10 \
            -o response.json \
            -w "%{http_code}" \
            -H "accept: application/json" \
            -H "X-Tenant: 670a48b168b0640a262870c4" \
            https://tenantapi.theartemis.ai/api/v1/checklists/templates || echo "000")

          END_TIME=$(date +%s)
          DURATION=$((END_TIME - START_TIME))

          echo "----------------------------------------"
          echo "HTTP Status: $STATUS"
          echo "Duration: ${DURATION}s"
          echo "----------------------------------------"

          if [ "$STATUS" != "200" ]; then
            echo "❌ API FAILED"
            echo "Failure Time: $(date)"
            cat response.json || true
            exit 1
          fi

          echo "✅ API OK"
          echo "Success Time: $(date)"
